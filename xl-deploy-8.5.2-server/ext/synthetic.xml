<?xml version='1.0' encoding='UTF-8'?>
<!--
Note: If you modify this file, you must restart the XL Deploy server.
-->
<synthetic xsi:schemaLocation="http://www.xebialabs.com/deployit/synthetic synthetic.xsd" xmlns="http://www.xebialabs.com/deployit/synthetic" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

  <!-- Kubernetes Profile Support -->

  <type-modification type="k8s.Master">
    <property name="kubectlHost" required="false" category="uccm" kind="ci" referenced-type="overthere.Host"/>
  </type-modification>

  <type type="uccm.Container" extends="udm.BaseDeployed" deployable-type="uccm.ContainerSpec" container-type="k8s.Namespace">
    <generate-deployable type="uccm.ContainerSpec" extends="udm.BaseDeployable"/>
    <property name="image"/>
    <property name="replicas" kind="integer" default="1"/>
    <property name="ports" required="false" kind="set_of_ci"
      referenced-type="uccm.ContainerPort" as-containment="true" description="List of ports to expose from the container."/>
    <property name="mountedVolumes" kind="set_of_ci" referenced-type="uccm.MountedVolume" as-containment="true" description="mounted volumes"/>
    <property name="profileName" default="default" category="Deployment Profile"/>
  </type>

  <type-modification type="uccm.ContainerSpec">
    <property name="ports" required="false" kind="set_of_ci"
      referenced-type="uccm.ContainerPortSpec" as-containment="true" description="List of ports to expose from the container."/>
    <property name="mountedVolumes" kind="set_of_ci" referenced-type="uccm.MountedVolumeSpec" as-containment="true" description="mounted volumes"/>
  </type-modification>


  <type type="uccm.ContainerPort" deployable-type="uccm.ContainerPortSpec"
    container-type="uccm.Container" extends="udm.BaseEmbeddedDeployed" description="Port binding.">
    <generate-deployable type="uccm.ContainerPortSpec" extends="udm.BaseEmbeddedDeployable"
      description="Specification for a Kubernetes container port binding."/>
    <property name="containerPort" required="true" kind="integer"
      description="Number of port to expose on the Podâ€™s IP address"/>
    <property name="exposeAsService" required="true" kind="boolean" default="false" category="Exposed Service"
      description="Whether to expose the container port as service."/>
    <property name="serviceType" category="Exposed Service" kind="enum" hidden="true" default="NodePort" required="false" description="Specifies the service type to be created.">
      <enum-values>
        <value>NodePort</value>
        <value>LoadBalancer</value>
        <value>ClusterIP</value>
      </enum-values>
    </property>
    <property name="servicePort" required="false" kind="string" category="Exposed Service"
      description="Name of the service port."/>
    <property name="exposeAsIngress" required="true" kind="boolean" default="false" category="Exposed Service"
      description="Whether to expose the service port as an ingress"/>
    <property name="serviceProfileName" default="default_service" category="Deployment Profile"/>
    <property name="ingressProfileName" default="default_ingress" category="Deployment Profile"/>
  </type>


  <!-- CloudFormation Profile Support -->

  <type-modification type="aws.cloudformation.DeployedTemplate">
    <property name="profileName" default="default" category="Deployment Profile"/>
  </type-modification>

  <!-- K8s Yaml File Profile Support -->
  <type-modification type="k8s.Resources">
    <property name="profileName" default="default" category="Deployment Profile"/>
  </type-modification>


  <!-- UCCM Dynamic Types -->

  <type type="uccm.DynamicDeployed" extends="udm.BaseDeployed" deployable-type="uccm.DynamicDeployable" virtual="true">
    <generate-deployable type="uccm.DynamicDeployable" extends="udm.BaseDeployable" virtual="true"/>
    <property name="apiVersion" description="Dynamic type version. eg. uccm/k8s/container/v1beta1"/>
    <property name="jsonSpec" size="large" description="Json specification define the required information for the dynamic type" />
  </type>

  <type type="uccm.DynamicDeployedArtifact" extends="udm.BaseDeployedArtifact" deployable-type="udm.BaseDeployableArtifact" virtual="true">
    <property name="apiVersion" description="Dynamic type version. eg. uccm/k8s/container/v1beta1"/>
    <property name="jsonSpec" size="large" description="Json specification define the required information for the dynamic type" />
  </type>


  <!-- UCCM K8s Dynamic Types -->
  <type type="uccm.k8s.DynamicDeployed" extends="uccm.DynamicDeployed" deployable-type="uccm.k8s.DynamicResource" container-type="k8s.BasePodContainer">
    <generate-deployable type="uccm.k8s.DynamicResource" extends="uccm.DynamicDeployable"/>
  </type>

  <type type="uccm.k8s.DynamicDeployedFileArtifact" extends="uccm.DynamicDeployedArtifact" deployable-type="uccm.k8s.DynamicFile" container-type="k8s.BasePodContainer">
    <generate-deployable type="uccm.k8s.DynamicFile" extends="udm.BaseDeployableFileArtifact"/>
  </type>

  <type type="uccm.k8s.DynamicDeployedFolderArtifact" extends="uccm.DynamicDeployedArtifact" deployable-type="uccm.k8s.DynamicFolder" container-type="k8s.BasePodContainer">
    <generate-deployable type="uccm.k8s.DynamicFolder" extends="udm.BaseDeployableFolderArtifact"/>
  </type>


  <!-- Profile Dictionary Support -->

  <type type="uccm.MountedVolume"  deployable-type="uccm.MountedVolumeSpec" container-type="uccm.Container"
    extends="udm.BaseEmbeddedDeployed" description="MountedVolume Management">
    <generate-deployable type="uccm.MountedVolumeSpec" extends="udm.BaseEmbeddedDeployable" />
    <property name="path" />
    <property name="isSensitive" required="false" kind="boolean" default="true" description="is it a sensitive data?"/>
  </type>

  <type type="uccm.ProfileDictionary" extends="udm.BaseConfigurationItem" root="Environments">
    <property name="entries" kind="map_string_string" description="The dictionary entries" required="false"/>
    <property name="encryptedEntries" kind="map_string_string" description="The encrypted dictionary entries" required="false" password="true"/>
  </type>

  <type type="uccm.ProfilePatchDictionary" extends="udm.BaseConfigurationItem" root="Environments">
    <property name="pathActivation" kind="list_of_string" description="Checks if path exists to trigger this dictionary." required="false"/>
    <property name="matchActivation" kind="map_string_string" description="Key by path, Json Value is expected value. Matches trigger this dictionary. JSON Patch Test Operation is performed" required="false"/>
    <property name="failOnNotFound" kind="boolean" default="true"/>
    <property name="add" kind="map_string_string" description="Path to add. Patch add operations" required="false"/>
    <property name="replace" kind="map_string_string" description="Path to replace. Patch replace operations" required="false"/>
    <property name="remove" kind="list_of_string" description="Paths to remove. Patch remove operations" required="false"/>
  </type>

  <type-modification type="udm.Environment">
    <property name="profileDictionaries" kind="list_of_ci" referenced-type="uccm.ProfileDictionary" required="false"
              description="The dictionaries providing profile values. If the same entry exists in multiple dictionaries, the first one in the list is taken"/>
    <property name="profilePatchDictionaries" kind="list_of_ci" referenced-type="uccm.ProfilePatchDictionary" required="false"
              description="The dictionaries providing profile patches."/>
  </type-modification>

</synthetic>
